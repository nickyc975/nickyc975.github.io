<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[赋值、浅拷贝与深拷贝]]></title>
    <url>%2Fblogs%2F2018%2F03%2F04%2Fcjeflp9ad0000twm4raiz4odq%2F</url>
    <content type="text"><![CDATA[引言前几天写Java时遇到一个问题，在我的代码中有这样一段： 1234567891011Set&lt;Person&gt; Temp = new HashSet&lt;Person&gt;();Set&lt;Person&gt; RemainedPerson = new HashSet&lt;Person&gt;();RemainedPerson.add(vertexA); // vertexA is an instance of Person class.while (!RemainedPerson.isEmpty()) &#123; for (Person person: RemainedPerson) &#123; // Do something that will change Temp. &#125; RemainedPerson = Temp; Temp.clear();&#125; 我本来是想用Temp临时保存一些Person对象，当for循环结束后再将Temp中保存的对象拷贝到RemainedPerson中，然后将Temp清空进行下一次while循环。但是实际上明明Temp里被加入了对象却依然会提前退出循环。我意识到可能是Temp.clear()将Temp清空的同时也将RemainedPerson清空了。一试果然如此！看来这里赋值后Temp和RemainedPerson应该是同一个对象，对一个进行操作另一个也会随之改变。 Java中的赋值、浅拷贝与深拷贝 要搞清上面说的问题为何会发生，首先要了解Java中的数据类型有哪些 Java中的数据类型分为基本数据类型和引用数据类型两大类，基本数据类型只有 1boolean, byte, char, short, int, long, float, double 这8种，除此之外的所有类型都属于引用类型。可以这么理解，基本数据类型就跟C语言中的数据类型一样，在定义时就会被分配空间，每一个变量都拥有自己独立的内存空间(1)。而引用数据类型就类似于C语言中的指针，定义时只分配指针的空间，而不会分配指针指向的内存空间，只有当使用 new 实例化对象时才会分配空间。 不过这里有一个要注意的问题是对于String类型，虽然它不属于基本数据类型，但是当采用如下的声明方式时： 1String str = "abc"; 应该把它当作基本数据类型来处理。 接下来还需要知道Java中如何将一个变量的值赋给另一个变量 Java中要将一个变量的值赋给另一个变量有两种方法，一种是用”=”号直接赋值，另一种是调用对象的clone方法(前提是对象实现了Cloneable接口)。对于基本数据类型只能使用”=”号进行赋值；而对于是实现了Cloneable接口的引用数据类型除了可以使用”=”号赋值外，还可以使用clone方法将一个对象的值拷贝给另一个同类型的对象，只不过这两种方法的操作结果是有区别的。 赋值对于基本数据类型，由于变量拥有自己独立的内存空间，所以赋值时是进行值拷贝，故如果把变量A的值赋给变量B，然后改变变量A的值并不会对B造成影响，这与我们的预期是相符的。 但是对于引用数据类型却并非如此。当使用”=”号将一个引用类型变量的值赋给另一个同类型的引用类型变量时，传递的只是对对象的引用。也就是说对于以下代码： 123ReferenceType A, B;B = new ReferenceType();A = B; 得到的A和B其实是对同一个对象的引用，或者可以理解为A和B其实是同一个指针，指向内存中的同一块内存。 但是这里有一个问题，就是如果声明A时就直接调用类的构造方法将其实例化了呢？这样A就有了自己的内存空间了，会不会在赋值时就进行值拷贝而不是引用拷贝呢？事实证明无论A有没有实例化，使用”=”号进行赋值时都是进行引用拷贝而非值拷贝。 所以，总结来说就是，使用”=”赋值时，如果变量是基本数据类型的，那就进行值拷贝，每一个变量都有自己独立的内存空间，互不干扰；而对于引用数据类型，则进行引用拷贝，”=”两边的两个变量将指向同一个对象，对一个进行操作就会影响到另一个。 浅拷贝未完待续 深拷贝未完待续 备注注一实际上并不一定是这样，这里还涉及到Java的内存管理机制，比较复杂，在本文中没有区分的必要，姑且认为每一个基本类型变量都拥有独立的内存空间。]]></content>
      <categories>
        <category>编程</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>数据类型</tag>
        <tag>深浅拷贝</tag>
      </tags>
  </entry>
</search>
